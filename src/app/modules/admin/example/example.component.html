<div class="flex flex-col flex-auto min-w-0">
  <div class="flex-auto p-6 sm:p-6">
    <fuse-alert [type]="'warning'"  [appearance]="'outline'" class="mb-4 mx-3">
      <span fuseAlertTitle>Client Suspended</span>
      Bespoke Alpha Solutions Suspended {{today | date: 'EEEE, MMMM d, y'}}
    </fuse-alert>
    <div class="sm:col-span-6 flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden">
      <div class="text-lg font-medium tracking-tight leading-6 truncate mb-2">
        <div class="flex items-center justify-between flex-wrap py-2">
          <div class="flex items-center">
            <div class="flex items-center">
              <div class="mr-3">Statuses</div>
              <label class="form-switch">
                <input type="checkbox" [(ngModel)]="featureStatus" (ngModelChange)="statusChanged($event)">
                <i></i>
              </label>
            </div>
            <div class="flex items-center">
              <div class="mr-3">My Clients</div>
              <label class="form-switch">
                <input type="checkbox" [(ngModel)]="myclientSelected">
                <i></i>
              </label>
            </div>
          </div>

          <div class="flex items-center">
            <div class="cursor-pointer mt-1" (click)="calculateMonth('decrement')">
              <mat-icon svgIcon="heroicons_outline:chevron-left"></mat-icon>
            </div>
            <div class="flex items-center">
              <input matInput [matDatepicker]="dp" [formControl]="date" class="w-20 text-lg" readonly>
              <mat-datepicker #dp startView="multi-year"(monthSelected)="chosenMonthHandler($event, dp)">
              </mat-datepicker>
              <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
            </div>
            <div class="cursor-pointer mt-1" (click)="calculateMonth('increment')">
              <mat-icon svgIcon="heroicons_outline:chevron-right"></mat-icon>
            </div>
          </div>

          <div class="search">
            <label for="search">
              <mat-icon>search</mat-icon>
            </label>
            <input id="search" type="text" placeholder="Search" [(ngModel)]="searchTerm">
          </div>

        </div>
      </div>
      <div class="flex flex-col flex-auto overflow-auto table-container">
        <ng-container *ngIf="(userTableList | search : searchTerm) as clientResult">
          <table class="min-w-240 overflow-y-visible"  mat-table  [dataSource]="clientResult">
            <ng-container matColumnDef="companyName" sticky>
              <th mat-header-cell *matHeaderCellDef class="pl-0 info-col"> Company Name </th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <a href="https://www.morethanaccountants.co.uk/salesflow/admin/v_lead.html?id={{element.id}}" target="_blank">{{element.limited_company}}</a>
                  <!-- <a href="https://www.morethanaccountants.co.uk/salesflow/admin/v_lead.html?id={{element.id}}" target="_blank"> {{element.companyName1}}</a> -->
                  <!-- <a href="https://www.morethanaccountants.co.uk/salesflow/admin/v_lead.html?id={{element.id}}" target="_blank"> {{element.companyName2}}</a> -->
                  <div class="logo-container flex items-center mt-1">
                    <a href="https://login.xero.com/identity/user/login" target="_blank">
                      <img class="h-auto w-6" src="assets/images/logo/bespoke.png" alt="bespoke">
                    </a>
                    <a href="https://app.dext.com/en/login" target="_blank">
                      <img class="h-auto w-6 mx-2" src="assets/images/logo/dext.png" alt="dext">
                    </a>
                    <a href="https://find-and-update.company-information.service.gov.uk/company/13436046" target="_blank">
                      <img class="h-auto w-6" src="assets/images/logo/ltd.png" alt="ltd">
                    </a>
                  </div>
                </div>
              </td>
            </ng-container>
          
            <ng-container matColumnDef="accountant">
              <th mat-header-cell *matHeaderCellDef class="info-col">Accountant</th>
              <td mat-cell *matCellDef="let element"> {{element.name}} {{element.surname}} </td>
            </ng-container>

            <ng-container matColumnDef="companyType">
              <th mat-header-cell *matHeaderCellDef class="info-col">Company Type</th>
              <td mat-cell *matCellDef="let element"> {{element.company_type}} </td>
            </ng-container>

            <ng-container matColumnDef="onboarding">
              <th mat-header-cell *matHeaderCellDef class="info-col">Onboarding Status</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex justify-center">
                  <mat-icon class="text-red-600 mr-2" svgIcon="heroicons_outline:x"></mat-icon> 
                  <mat-icon class="cursor-pointer" svgIcon="heroicons_outline:pencil" (click)="openOnboarding()" ></mat-icon> 
                </div>
              </td>
            </ng-container>
      
            <ng-container matColumnDef="saledate">
              <th mat-header-cell *matHeaderCellDef class="package-col">Date Of Sale</th>
              <td mat-cell *matCellDef="let element"> {{element.saledate | date:'M/d/yyyy'}} </td>
            </ng-container>
      
            <ng-container matColumnDef="package">
              <th mat-header-cell *matHeaderCellDef class="package-col">Package</th>
              <td mat-cell *matCellDef="let element"> {{element.package}} </td>
            </ng-container>
      
            <ng-container matColumnDef="quarters">
              <th mat-header-cell *matHeaderCellDef class="package-col">Bookkeeping Quarters</th>
              <td mat-cell *matCellDef="let element"> {{element.bookkeeping_quarter}}</td>
            </ng-container>
      
            <ng-container matColumnDef="frequency">
              <th mat-header-cell *matHeaderCellDef class="package-col">Bookkeeping Frequency</th>
              <td mat-cell *matCellDef="let element"> {{element.frequency}}</td>
            </ng-container>
      
            <ng-container matColumnDef="bookkeeper">
              <th mat-header-cell *matHeaderCellDef class="book-col">Management Account</th>
              <td mat-cell *matCellDef="let element"> {{element.bookKeeper}} </td>
            </ng-container>
      
            <ng-container matColumnDef="completionweek">
              <th mat-header-cell *matHeaderCellDef class="book-col">Target Completion Week</th>
              <td mat-cell *matCellDef="let element"> {{element.completionweek}} </td>
            </ng-container>

            <ng-container matColumnDef="bookKeepingStatus">
              <th mat-header-cell *matHeaderCellDef class="book-col">June Bookkeeping Status</th>
              <td mat-cell *matCellDef="let element" class="text-center"> 
                <mat-icon *ngIf="!element.bookkeeping_status_saved" class="cursor-pointer" (click)="startUpdates('start', 'bookkeep', element.bookkeeping_status, element.id)"
                  svgIcon="heroicons_outline:plus-sm">
                </mat-icon> 
                <div *ngIf="element.bookkeeping_status_saved" class="flex items-center"> 
                  <ng-container *ngFor="let statusItem of element.bookkeeping_status; let ind = index" >
                    <ng-container *ngIf="statusItem.static_id == element.bookkeeping_status_saved" >
                      <button mat-icon-button>
                        <mat-icon class="text-red-600" svgIcon="heroicons_outline:arrow-sm-left" 
                        (click)="ind > 0?openConfirmationDialog('bookkeeping', ind,element.bookkeeping_status, element.id):startUpdates('end','bookkeep',element.bookkeeping_status, element.id)"></mat-icon>
                      </button>
                      <button  mat-raised-button [ngClass]="{'start': statusItem.static_id >= 2 && statusItem.static_id <= 4, 'in-progress': statusItem.static_id >= 5 && statusItem.static_id <= 10,'complete':statusItem.static_id >= 11 && statusItem.static_id <= 13 }"
                        (click)="ind < element.bookkeeping_status.length -1 ?getNextStatus('bookkeeping', ind,element.bookkeeping_status, element.id):$event.stopPropagation()"> 
                        {{ statusItem.task }} 
                      </button>
                      <mat-icon [ngClass]="{'blink': element.bookkeeping_status[ind]?.escalated === '0'}"  class="cursor-pointer" svgIcon="heroicons_outline:exclamation-circle"></mat-icon>
                    </ng-container>
                  </ng-container>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="vatRegistered">
              <th mat-header-cell *matHeaderCellDef class="vat-col">VAT Registered</th>
              <td mat-cell *matCellDef="let element"><mat-icon class="text-green-600" svgIcon="heroicons_outline:check"></mat-icon> </td>
            </ng-container>
          
            <ng-container matColumnDef="vatQuarter">
              <th mat-header-cell *matHeaderCellDef class="vat-col">VAT Quarter</th>
              <td mat-cell *matCellDef="let element">{{element.vatQuarter}} </td>
            </ng-container>
          
            <ng-container matColumnDef="vatscheme">
              <th mat-header-cell *matHeaderCellDef class="vat-col">VAT Scheme</th>
              <td mat-cell *matCellDef="let element">{{element.vatscheme}} </td>
            </ng-container>
    
            <ng-container matColumnDef="vatStatus">
              <th mat-header-cell *matHeaderCellDef class="vat-col">June VAT Status</th>
              <td mat-cell *matCellDef="let element" class="text-center">
                <mat-icon *ngIf="!element.vat_status_saved" class="cursor-pointer" (click)="startUpdates('start','vat',element.vat_status, element.id)"
                  svgIcon="heroicons_outline:plus-sm">
                </mat-icon>
                <div *ngIf="element.vat_status_saved" class="flex items-center"> 
                  <ng-container *ngFor="let vatItem of element.vat_status; let ind = index" >
                    <ng-container *ngIf="vatItem.static_id == element.vat_status_saved" >
                      <button mat-icon-button>
                        <mat-icon class="text-red-600" svgIcon="heroicons_outline:arrow-sm-left" 
                        (click)="ind > 0?openConfirmationDialog('vat', ind,element.vat_status, element.id):startUpdates('end','vat',element.vat_status, element.id)"></mat-icon>
                      </button>
                      <button  mat-raised-button [ngClass]="{'start': vatItem.static_id == 1 && vatItem.static_id == 2, 'in-progress': vatItem.static_id == 3,'complete':vatItem.static_id == 4 }"
                        (click)="ind < element.vat_status.length -1 ?getNextStatus('vat', ind,element.vat_status, element.id):$event.stopPropagation()"> 
                        {{ vatItem.task }} 
                      </button>
                      <mat-icon [ngClass]="{'blink': element.vat_status[ind]?.escalated === '0'}"  class="cursor-pointer" svgIcon="heroicons_outline:exclamation-circle"></mat-icon>
                    </ng-container>
                  </ng-container>
                </div>
              </td>
            </ng-container>
              
            <ng-container matColumnDef="eoy">
              <th mat-header-cell *matHeaderCellDef class="account-col">EOY Accountant</th>
              <td mat-cell *matCellDef="let element">{{element.eoy}} </td>
            </ng-container>
              
            <ng-container matColumnDef="oneoff">
              <th mat-header-cell *matHeaderCellDef class="account-col">One-off Work</th>
              <td mat-cell *matCellDef="let element">{{element.oneoff}} </td>
            </ng-container>
              
            <ng-container matColumnDef="endDate">
              <th mat-header-cell *matHeaderCellDef class="account-col">Year end Date</th>
              <td mat-cell *matCellDef="let element">{{element.endDate | date:'dd - MMM' }} </td>
            </ng-container>
              
            <ng-container matColumnDef="duedate">
              <th mat-header-cell *matHeaderCellDef class="account-col">Due Date</th>
              <td mat-cell *matCellDef="let element">{{element.duedate | date:'dd - MMM' }} </td>
            </ng-container>
              
            <ng-container matColumnDef="accountsStatus1">
              <th mat-header-cell *matHeaderCellDef class="account-col">2021 Accounts Status</th>
              <td mat-cell *matCellDef="let element">
                <mat-icon *ngIf="!element.annual_accounts_saved" class="cursor-pointer" (click)="startUpdates('start','annual_accounts',element.annual_accounts_status, element.id)"
                svgIcon="heroicons_outline:plus-sm">
              </mat-icon>
                <div *ngIf="element.annual_accounts_saved" class="flex items-center"> 
                  <ng-container *ngFor="let accItem of element.annual_accounts_status; let ind = index" >
                    <ng-container *ngIf="accItem.static_id == element.annual_accounts_saved" >
                      <button mat-icon-button>
                        <mat-icon class="text-red-600" svgIcon="heroicons_outline:arrow-sm-left" 
                        (click)="ind > 0?openConfirmationDialog('annual_accounts', ind,element.annual_accounts_status, element.id):startUpdates('end','annual_accounts',element.annual_accounts_status, element.id)"></mat-icon>
                      </button>
                      <button  mat-raised-button [ngClass]="{'start': accItem.static_id >= 2 && accItem.static_id <= 5, 'in-progress': accItem.static_id >= 6 && accItem.static_id <= 8,'complete':accItem.static_id == 9 }"
                        (click)="ind < element.annual_accounts_status.length -1 ?getNextStatus('annual_accounts', ind,element.annual_accounts_status, element.id):$event.stopPropagation()"> 
                        {{ accItem.task }} 
                      </button>
                      <mat-icon [ngClass]="{'blink': element.annual_accounts_status[ind]?.escalated === '0'}"  class="cursor-pointer" svgIcon="heroicons_outline:exclamation-circle"></mat-icon>
                    </ng-container>
                  </ng-container>
                </div>
              </td>
            </ng-container>
              
            <ng-container matColumnDef="accountsStatus2">
              <th mat-header-cell *matHeaderCellDef class="account-col">2022 Accounts Status</th>
              <td mat-cell *matCellDef="let element"> 
                <mat-icon *ngIf="!element.annual_accounts_saved" class="cursor-pointer" (click)="startUpdates('start','accNew',element.annual_accounts_status, element.id)"
                svgIcon="heroicons_outline:plus-sm">
               </mat-icon>
                <div *ngIf="element.annual_accounts_saved" class="flex items-center"> 
                  <ng-container *ngFor="let accItem of element.annual_accounts_status; let ind = index" >
                    <ng-container *ngIf="accItem.static_id == element.annual_accounts_saved" >
                      <button mat-icon-button>
                        <mat-icon class="text-red-600" svgIcon="heroicons_outline:arrow-sm-left" 
                        (click)="ind > 0?openConfirmationDialog('accNew', ind,element.annual_accounts_status, element.id):startUpdates('end','accNew',element.annual_accounts_status, element.id)"></mat-icon>
                      </button>
                      <button  mat-raised-button [ngClass]="{'start': accItem.static_id >= 2 && accItem.static_id <= 5, 'in-progress': accItem.static_id >= 6 && accItem.static_id <= 8,'complete':accItem.static_id == 9 }"
                        (click)="ind < element.annual_accounts_status.length -1 ?getNextStatus('accNew', ind,element.annual_accounts_status, element.id):$event.stopPropagation()"> 
                        {{ accItem.task }} 
                      </button>
                      <mat-icon [ngClass]="{'blink': element.annual_accounts_status[ind]?.escalated === '0'}"  class="cursor-pointer" svgIcon="heroicons_outline:exclamation-circle"></mat-icon>
                    </ng-container>
                  </ng-container>
                </div>
              </td>
            </ng-container>
              
              
            <ng-container matColumnDef="number">
              <th mat-header-cell *matHeaderCellDef class="assessment-col">Number Of Active Directors</th>
              <td mat-cell *matCellDef="let element">{{element.number}} </td>
            </ng-container>
              
            <ng-container matColumnDef="self1">
              <th mat-header-cell *matHeaderCellDef class="assessment-col">2021 Self Assessment Status</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex justify-center">
                  <mat-icon class="text-green-600" svgIcon="heroicons_outline:check"></mat-icon>
                  <mat-icon class="cursor-pointer" svgIcon="heroicons_outline:pencil" (click)="editAssessment()"></mat-icon> 
                </div>
              </td>
            </ng-container>
              
            <ng-container matColumnDef="self2">
              <th mat-header-cell *matHeaderCellDef class="assessment-col">2022 Self Assessment Status</th>
              <td mat-cell *matCellDef="let element">
                <div class="flex justify-center">
                  <mat-icon class="text-red-600" svgIcon="heroicons_outline:x"></mat-icon>
                  <mat-icon class="cursor-pointer" svgIcon="heroicons_outline:pencil" (click)="editAssessment()"></mat-icon> 
                </div>
              </td>
            </ng-container>
              
           
    
            <ng-container matColumnDef="header-first-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="4"> 
                Basic Info
              </th>
            </ng-container>
            <ng-container matColumnDef="header-second-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="4"> 
                Package
              </th>
            </ng-container>
            <ng-container matColumnDef="header-third-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="3"> 
               Bookkeeping
              </th>
            </ng-container>
            <ng-container matColumnDef="header-forth-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="4"> 
                VAT
              </th>
            </ng-container>
            <ng-container matColumnDef="header-fifth-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="6"> 
                Annual Accounts
              </th>
            </ng-container>
            <ng-container matColumnDef="header-six-group">
              <th mat-header-cell *matHeaderCellDef  class="font-extrabold text-left border-r border-t" [attr.colspan]="3"> 
               Self Assessments
              </th>
            </ng-container>
            
            <ng-container *ngIf="!featureStatus">
              <tr mat-header-row *matHeaderRowDef="['header-first-group', 'header-second-group','header-third-group',
              'header-forth-group','header-fifth-group','header-six-group']"  ></tr>
            </ng-container>
           
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"  [ngClass]="{'suspended': row?.isSuspended}"></tr>
          </table>
          <p *ngIf="!clientResult.length" class="p-4 text-center font-semibold ">
            Searched Result Not Found !!!
          </p>  
        </ng-container>
      </div>
  </div>
  <div class="text-right mt-3.5">
    <app-paginator [pageSizes]="[10, 20, 30]" [count]="paginationConfig.total" 
      [perPage]="paginationConfig.limit" (pageChange)="onPageChange($event)">
    </app-paginator>
  </div>
  </div>
</div>